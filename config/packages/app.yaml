services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true
        autoconfigure: true
        public: false

    App\:
        resource: '../../src/{Command,Security,EventListener,Service,Queue}'

    App\Controller\:
        resource: '../../src/Controller'
        public: true
        tags: ['controller.service_arguments']

    # Autowiring the httpclient
    App\Service\DataDownloaderService:
        $httpClient: "@httplug.client.downloader"
        $tempFolder: '%kernel.project_dir%/var/temp'

    # Autowiring DataService parameters
    App\Service\DataService:
        $indexableContentTypes: "%indexable_content_types%"

    local_cache:
      class: 'Symfony\Component\Cache\Adapter\ApcuAdapter'

    # Autowiring the Registry client configurator
    OneOffTech\KLinkRegistryClient\HttpClientConfigurator:
      arguments:
        - "@httplug.client.kregistry"
      calls:
        -
          method: setEndpoint
          arguments:
            - '%env(KLINK_REGISTRY_API_URL)%'

    OneOffTech\KLinkRegistryClient\ApiClient:
        factory: ['OneOffTech\KLinkRegistryClient\ApiClient', fromConfigurator]

    # Autowire ApiSecretAuthenticator user provider
    App\Security\Authenticator\ApiSecretAuthenticator:
        $enabled: '%env(KLINK_REGISTRY_ENABLED)%'
